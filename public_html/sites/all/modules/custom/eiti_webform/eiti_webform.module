<?php

/**
 * Implements hook_form_alter().
 */
function eiti_webform_form_alter(&$form, &$form_state, $form_id) {

  if (substr_count($form_id, 'webform_client_form_') > 0) {
  	if (isset($form['details']['page_num']['#value']) 
  	  && isset($form['details']['page_count']['#value'])) {

      $page_num = $form['details']['page_num']['#value'];
      $page_count = $form['details']['page_count']['#value'];

      if (($page_num != $page_count) && (isset($form['captcha']) && !empty($form['captcha']))) {
        unset($form['captcha']);
      }
  	}
  }
}

/**
 * Implements hook_page_alter()
 */
function eiti_webform_init() {
  global $user;
  $path = current_path($path);

  if (substr_count($path, 'webform-results') > 0) {
    $has_role = user_has_role('complaints viewer', $user);

    if ($has_role == FALSE || $user->uid == 1) {
      drupal_access_denied();
    }
  }
}